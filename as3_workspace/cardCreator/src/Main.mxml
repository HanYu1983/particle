<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009"
                       xmlns:s="library://ns.adobe.com/flex/spark"
                       xmlns:mx="library://ns.adobe.com/flex/mx" applicationComplete="appStart()">
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<s:Panel title="卡牌產生器" width="100%" height="100%">
		<!--
		<s:HGroup width="100%" height="100%" horizontalAlign="center" verticalAlign="middle">
			<s:VGroup horizontalAlign="center">
				<s:Button id="btn_upload" click="onBtnClick( event )">上傳</s:Button>
				<mx:UIComponent id="container_flash"></mx:UIComponent>
			</s:VGroup>
			
		</s:HGroup>
		-->
	</s:Panel>
	<fx:Script>
		<![CDATA[
		
		import flash.desktop.NativeApplication;
		import flash.display.Loader;
		import flash.display.LoaderInfo;
		import flash.events.Event;
		import flash.events.EventDispatcher;
		import flash.events.MouseEvent;
		import flash.net.URLRequest;
		import flash.system.ApplicationDomain;
		import view.UI;
		import view.VicEvent;
		
		private var _ui:EventDispatcher;
		private var _source:ApplicationDomain;
		private var _template:Class;
		
		public function appStart():void {
		
			var l:Loader = new Loader();
			l.load( new URLRequest( 'src/source.swf' ));
			l.contentLoaderInfo.addEventListener( Event.COMPLETE, onComplete );
			
			_ui = new UI();
			_ui.addEventListener( 'onFlieUpload', onFlieUpload );
			
			_ui.dispatchEvent( new Event( 'browseFile' ) );
			
		}
		
		private function onFlieUpload( e:VicEvent ):void {
			
			_ui.dispatchEvent( new VicEvent( 'appendCard', {
				template:_template,
				data: e.data
			} ));
		}
		
		private function onComplete( e:Event ):void {
			var info:LoaderInfo = e.currentTarget as LoaderInfo;
			_source = info.applicationDomain;
			_template = _source.getDefinition( 'TemplateCard' ) as Class;
		}
		/*
		public function onBtnClick( e:MouseEvent ):void {
			switch( e.currentTarget.id ){
				case 'btn_upload':
					_ui.dispatchEvent( new Event( 'browseFile' ) );
			}
		}
		*/
		]]>
	</fx:Script>
</s:WindowedApplication>