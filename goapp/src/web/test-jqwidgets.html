<html>
	<head>
		<meta charset="utf-8"/>
		<script type="text/javascript" src="res/js/lib/jquery/jquery-1.11.1.min.js"></script>	
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxcore.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxbuttons.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxsplitter.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxdragdrop.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxinput.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxtree.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxnumberInput.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxexpander.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxscrollbar.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxpanel.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxComboBox.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxlistbox.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxgrid.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxdata.js"></script>
		<script type="text/javascript" src="res/js/lib/jqwidgets/jqxgrid.selection.js"></script>
			
		<script type="text/javascript" src="res/js/lib/jquery/jquery.tmpl.min.js"></script>
		<script type="text/javascript" src="res/js/lib/leo.utils.js"></script>
		
		<link rel="stylesheet" href="res/js/lib/jqwidgets/styles/jqx.base.css" type="text/css" />
		<link rel="stylesheet" href="res/js/lib/jqwidgets/styles/jqx.metrodark.css" type="text/css" />
		<link rel="stylesheet" href="res/js/lib/jqwidgets/styles/jqx.arctic.css" type="text/css" />
		<link rel="stylesheet" type="text/css" href="res/css/normalize.css">
	</head>
	<style>
	body{
		padding:0;
		position:absolute;
		width:100%;
		height:100%;
		overflow:hidden;
	}
	input{
		font-family:Microsoft JhengHei;
	}
	
	.hori{
		display:inline-block;
	}
	
	.group{
		position:relative; 
		width:100%;
		min-width:250px;
	}
	</style>
	<script id="tmpl_prop" type="jquery-x-tmpl">
		<div proptype=${id} class="hori" style="margin-bottom:5px;">
			<div class="hori" style="width:60px; text-align:right;">${name}</div>
			<div class="hori">
				<div id="spr_value" jqx="jqxNumberInput" style="position:relative; top:10px; " data-options=${datastr}></div>
			</div>
		</div>
	</script>
</head>
<body>
	<div jqx="jqxSplitter" data-options='{"height": "100%", "width": "100%", "panels": [{ "size": 750,"min":750 }]}'>
		<div>
			<div jqx="jqxSplitter" data-options='{"height": "100%", "width": "100%", "orientation": "horizontal", "panels": [{ "size": "200px" }]}'>
				<div>
					<div jqx="jqxPanel" data-options='{"height": "100%", "width": "100%"}'>
						<div class="group" style="text-align:center;">
							<div class="hori">
								<input id="btn_addTreeNode" jqx="jqxButton" type="button" value="新增" />
							</div>
							<div class="hori">
								<input id="btn_removeTreeNode" jqx="jqxButton" type="button" value="刪除" />
							</div>
						</div>
						<div id="tree_particle" jqx="jqxTree" class="jqx-hideborder" data-options='{"allowDrag": true, "allowDrop": true, "height": "180px", "width": "100%"}'>
							<!-- created by script -->
						</div>
					</div>
				</div>
				<div>
					<div jqx="jqxPanel" data-options='{"height": "100%", "width": "100%"}'>
						<div class="group" style="text-align:center; margin-bottom:10px; margin-top:10px; ">
							<div class="hori" style="width:100px; ">
								<input id="txt_name" type="text" jqx="jqxInput" style="width:100%; " >
							</div>
							<div class="hori">
								<input id="btn_confirmName" type="button" jqx="jqxButton" value="確定" >
							</div>
						</div>
						<div id="mc_props_container" class="group" style="min-width:150px; margin-bottom:50px;" >
							<!-- created by script -->
						</div>
						<div class="group" style="min-width:700px; text-align:center; margin-bottom:10px; ">
							<div class="hori">
								<input id="btn_addDynamic" jqx="jqxButton" type="button" value="新增" />
								<input id="btn_removeDynamic" jqx="jqxButton" type="button" value="刪除" />
								<input id="btn_moveUp" jqx="jqxButton" type="button" value="上移" />
								<input id="btn_moveDown" jqx="jqxButton" type="button" value="下移" />
							</div>
							<div class="hori">
								<div id="combo_props" style="position:relative; top:10px;" jqx="jqxComboBox">
									<!-- created by script below -->
								</div>
							</div>
							<div class="hori">
								<div id="combo_dtype" style="position:relative; top:10px;" jqx="jqxComboBox">
									<!-- created by script below -->
								</div>
							</div>
							<div class="hori">
								<div id="spr_value1" jqx="jqxNumberInput" style="position:relative; top:10px; " data-options='{"width":"80px","inputMode":"simple","spinButtons":true}'></div>
							</div>
							<div class="hori">
								<div id="spr_value2" jqx="jqxNumberInput" style="position:relative; top:10px; " data-options='{"width":"80px","inputMode":"simple","spinButtons":true}'></div>
							</div>
							<div class="hori">
								<div id="spr_value3" jqx="jqxNumberInput" style="position:relative; top:10px; " data-options='{"width":"80px","inputMode":"simple","spinButtons":true}'></div>
							</div>
							<div class="hori">
								<div id="spr_value4" jqx="jqxNumberInput" style="position:relative; top:10px; " data-options='{"width":"80px","inputMode":"simple","spinButtons":true}'></div>
							</div>
							<div class="hori">
								<div id="spr_value5" jqx="jqxNumberInput" style="position:relative; top:10px; " data-options='{"width":"80px","inputMode":"simple","spinButtons":true}'></div>
							</div>
						</div>
						<div class="group" style="text-align:center">
							<div class="hori" style="width:700px;">
								<div id="table_props" jqx="jqxGrid">
									<!-- created by script -->
								</div>
							</div>
						</div>	
					</div>
				</div>
			</div>
			
		</div>
		<div>
			<div id="canvas_container" style="width:100%; height:100%">
				<canvas id='webgl' width=800 height=600></canvas>
			</div>
		</div>
	</div>
</body>
<script src='res/js/lib/async.js'></script>
<script src='res/js/lib/rx.all.min.js'></script>
<script src='res/js/lib/three.min.js'></script>
<script src='res/js/lib/underscore-min.js'></script>
<script src='res/js/common.js'></script>
<script src='res/cljs/goog/base.js'></script>
<script src='res/cljs/cljs.js'></script>
<script src='res/js/api.js'></script>
<script src="res/js/haxe.js"></script>
<script type="text/javascript">

	$(document).ready( parseJqx );
	
	function initJqx( root, theme ){
		root.find('[jqx]').each( function( id, dom ){
			var jdom = $( dom );
			var jqxType = jdom.attr( 'jqx' );
			var constr = jdom.attr( 'data-options' );
			var constrobj;
			if( constr == undefined ){
				constrobj = {};
			}else{
				constrobj = JSON.parse( constr );
			}
			constrobj.theme = theme;
			jdom[jqxType]( constrobj );
		});
	}
	
	function parseJqx(){
		var theme = 'metrodark';
		//var theme = 'arctic';
		
		initJqx( $('body'), theme );
		
		var ary_props = [ 	{id:'lifetime', name:'生命', min:0, max:100000}, 
							{id:'mass', name:'質量', min:0, max:100000}, 
							{id:'pos_r', name:'角度', min:-360, max:360}, 
							{id:'vel_x', name:'速度x', min:-100000, max:100000}, 
							{id:'vel_y', name:'速度y', min:-100000, max:100000}, 
							{id:'vel_r', name:'旋轉速度', min:-100000, max:100000}, 
							{id:'size_x', name:'粒子寬度', min:0, max:100000}, 
							{id:'size_y', name:'粒子高度', min:0, max:100000}, 
							{id:'count', name:'發射數目', min:1, max:3}, 
							{id:'duration', name:'週期毫秒', min:20, max:100000}, 
							{id:'angle', name:'發射角度', min:0, max:360}, 
							{id:'range', name:'發射範圍', min:0, max:360}, 
							{id:'force', name:'發射力道', min:0, max:100000}];
							
		var tmpl_prop = $('#tmpl_prop' );
		var mc_props_container = $('#mc_props_container');
		
		for( var i = 0; i < ary_props.length; ++i ){
			var tmplModel = ary_props[i];
			tmplModel.datastr = JSON.stringify({	"width":"80px",
									"inputMode":"simple",
									"spinButtons":true, 
									"min": tmplModel.min , 
									"max": tmplModel.max });
			var jdom = tmpl_prop.tmpl( tmplModel ) ;
			initJqx( jdom, theme );
			mc_props_container.append( jdom );
		}
		
		var combo_props = $('#combo_props' );
		ary_props = [ 	{id:'x', name:'位置x'}, 
						{id:'y', name:'位置y'}, 
						{id:'rot', name:'角度'}, 
						{id:'vx', name:'速度x'}, 
						{id:'vy', name:'速度y'}, 
						{id:'vr', name:'旋轉速度'}, 
						{id:'scale-x', name:'粒子寬度'}, 
						{id:'scale-y', name:'粒子高度'}, 
						{id:'r', name:'紅'}, 
						{id:'g', name:'綠'}, 
						{id:'b', name:'藍'}, 
						{id:'emit-count', name:'發射數目'}, 
						{id:'emit-duration', name:'週期毫秒'}, 
						{id:'emit-angle', name:'發射角度'}, 
						{id:'emit-range', name:'發射範圍'}, 
						{id:'emit-force', name:'發射力道'}];
						
		var comboSource = [];
		for( var i = 0; i < ary_props.length; ++i ){
			comboSource.push( '<div ptype="' + ary_props[i].id + '">' + ary_props[i].name + '</div>' );
		}
		combo_props.jqxComboBox( { source: comboSource, width:80, selectedIndex:0 } );
		
		combo_dtype = $('#combo_dtype' );
		ary_props = [ 	{id:'const', name:'常數'}, 
						{id:'constAdd', name:'常數累加'}, 
						{id:'linear', name:'線性'}, 
						{id:'linearAdd', name:'線性累加'}, 
						{id:'randStartAdd', name:'隨機開始'}, 
						{id:'custom', name:'自訂'} ]
		
		comboSource = [];
		for( var i = 0; i < ary_props.length; ++i ){
			comboSource.push( '<div ptype="' + ary_props[i].id + '">' + ary_props[i].name + '</div>' );
		}
		combo_dtype.jqxComboBox( { source: comboSource, width:80, selectedIndex:0 } );
		
		
		//create gried
		
		$("#table_props").jqxGrid(
		{
			width: '100%',
			source: {},
			showtoolbar: false,
			columns: [
			  { text: '屬性', datafield: 'ptype', width: 100 },
			  { text: '方法', datafield: 'method', width: 100 },
			  { text: '參數一', datafield: 'value1', width: 100 },
			  { text: '參數二', datafield: 'value2', width: 100 },
			  { text: '參數三', datafield: 'value3', width: 100},
			  { text: '參數四', datafield: 'value4', width:100 },
			  { text: '參數五', datafield: 'value5', width:100 }
			]
		});    
		
		window.haxeStart();
	}
</script>
<script>
goog.require("app.particle.main");
</script>

</html>