<html>
<head>
	<meta charset="utf-8"/>
	<title>上善若水app</title>
	<!--page information for search engine-->
	<meta name="title" content="上善若水app" />
	<meta name="keyword" content="上善若水app,余氏k線圖,幽夢仙夢" />
	<meta name="description" content="上善若水app" />
	<link rel="image_src" href="../common/images/logo.jpg"/>
	
	<!--share information for fb-->
	<meta property="og:description" content="上善若水app" />
	<meta property="og:title" content="上善若水app" />
	<meta property="og:url" content="http://particle-979.appspot.com/manager/index.html#"/>
	<meta property="og:image" content="../common/images/logo.jpg" />
	
	<link rel="stylesheet" type="text/css" href="../common/js/lib/jquery-easyui-1.4.3/themes/black/easyui.css">
	<link rel="stylesheet" type="text/css" href="../common/js/lib/jquery-easyui-1.4.3/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="../common/css/normalize.css">
	<link rel="stylesheet" type="text/css" href="css/basic.css">
		
	<script type="text/javascript" src="../common/js/lib/leo.utils.js"></script>
	<script type="text/javascript" src="../common/js/lib/jquery-easyui-1.4.3/jquery.min.js"></script>
	<script type="text/javascript" src="../common/js/lib/jquery-easyui-1.4.3/jquery.easyui.min.js"></script>
	
</head>
	<body>
		<script id="tmpl_subject" type="jquery-x-tmpl">
			<div class="group">
				<div class="hori" style="width:15%">
					<a id="btn_link" href="#" target="_blank" class="easyui-linkbutton btn_link" data-options="iconCls:'icon-back'" ></a>
				</div>
				<div class="hori" style="width:83%">
					<a id="btn_show" href="#" class="easyui-linkbutton btn_show" data-options="toggle:true,group:'g1',selected:false" >${title}</a>
				</div>
			</div>
		</script>
		<div class="easyui-layout" style="width:100%;height:100%;">
			<div data-options="region:'west',title:'選單',split:false,collapsible:false" style="width:200px; min-width:200px;">
				<div id="mc_subjectContainer" class="group">
				</div>
				<div class="group" style="margin-top:60px;">
					<a id="btn_about" href="#" class="easyui-linkbutton" onclick="$('#dia_about').panel( 'open' )" data-options="iconCls:'icon-help'"></a>
				</div>
			</div>
			<div data-options="region:'center',title:'內容'" style="">
				<div id="mc_showContainer" style="position:relative; width:100%; height:100%; ">
				</div>
			</div>
			<div id="dia_about" class="easyui-dialog" title="上善若水" data-options="iconCls:'icon-help',closed:true" style="padding:10px">
				<div class="group" style="position:relative; width:100%; text-align:center;">
					<div class="hori" >
						<img src="../common/images/logo.jpg" style="width:150px;">
						<br/>
						上善若水粉絲頁
						<br/>
						<a style="color:yellow; font-size:12px;" href="//www.facebook.com/pages/上善若水/1653920964852269" target="_blank">//www.facebook.com/pages/上善若水/1653920964852269</a>
					</div>
				</div>
			</div>
		</div>
		<div id="div" style="position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; overflow:hidden;">
			<!-- by script -->
		</div>
		<div style="display:none;">
			<img id='glow_128_128' src='../common/images/effect/glow_128_128.jpg'>
			<img id='glow_png_128_128' src='../common/images/effect/glow_png_128_128.png'>
			<img id='glow_color_png_128_128' src='../common/images/effect/glow_color_png_128_128.png'>
			<img id='fire_128_128' src='../common/images/effect/fire_128_128.jpg'>
			<img id='fire_png_128_128' src='../common/images/effect/fire_png_128_128.png'>
			<img id='fire_color_png_128_128' src='../common/images/effect/fire_color_png_128_128.png'>
			<img id='smoke_128_128' src='../common/images/effect/smoke_128_128.png'>
			<img id='lead_32_32' src='../common/images/effect/lead_32_32.png'>
			<img id='cornerGlow_256_256' src='../common/images/effect/cornerGlow_256_256.png'>
		</div>
		<script src="../common/js/lib/underscore/underscore-min.js"></script>	
		<script src="../common/js/lib/jquery/jquery.tmpl.min.js"></script>
		<script src="../common/js/lib/myapp.facebook.js"></script>
		<script src="../common/js/lib/google/ga.js"></script>
		<script src="../common/js/lib/han/particle.js"></script>
		<script src="../common/js/lib/han/particleDrawer.js"></script>
		<script src="../common/js/admin.js"></script>	
		<script>
		$(function(){
			var uiconfig = {
				index: 4,
				apps: [
					{
						"title":"余氏K線圖",
						"link":"../stock/index.html",
						"html":"intro/stock.html"
					},
					{
						"title":"幽夢仙境",
						"link":"../particle/index.html",
						"html":"intro/particle.html"
					},
					{
						"title":"組牌風雲",
						"link":"../card/manager.html?game=gundamWar",
						"html":"intro/cardsearch.html",
						"script": function(dom){
							admin.showHotGame(dom.find('#mc_game'));
						}
					},
					{
						"title":"卡牌風雲",
						"link":"../card/index.html",
						"html":"intro/card.html"
					},
					{
						"title":"秀牌風雲",
						"link":"../deckWiki/index.html",
						"html":"intro/deckwiki.html"
					},
					{
						"title":"函數式語言粒子系統",
						"link":"../particle/index_clojure.html",
						"html":"intro/funcparticle.html"
					},
					{
						"title":"開發人員",
						"html":"intro/team.html"
					}
				]
			}
			function applyConfig( dom, config ){
				var tabs = dom.find('#mc_subjectContainer')
				var content = dom.find('#mc_showContainer')
				
				for(var i in config.apps){
					var app = config.apps[i]
					var dom = $('#tmpl_subject').tmpl(app);
					dom.find( '.easyui-linkbutton' ).linkbutton();
					dom.find( '#btn_link' ).attr('href', app.link)
					dom.find( '#btn_show' ).click( (function(app){
						return function(){
							$.ajax({
								url : app.html,
								success: function(data){
									content.html(data)
									content.find( '.easyui-linkbutton' ).linkbutton();
									if( app.script ){
										app.script(content)
									}
								}
							})
						}
					})(app))
					tabs.append( dom )
					if( parseInt(i) == config.index ){
						dom.find( '#btn_show' ).trigger('click')
					}
				}
			}
			applyConfig($('body'), uiconfig)
			showParticle()
		})
		
		function showParticle(){
			var imgs = _.reduce( $('img'), function(start, img2){
				var id = $(img2).attr('id')
				var obj = {}
				obj[id] = img2
				return _.extend( start, obj )
			}, {})
	
			var divDom = $('#div' )
			var drawDiv = particleDrawer.dom( divDom )
	
			var w = divDom.width()
			var h = divDom.height()
	
			var pool = particle.pool( 200 )
			var ps = particle.particleSystem(pool, function( type, key ){
				if( type == 'div' ){
					return imgs[key]
				}
				return null
			})
			var last = new Date().getTime()
			setTimeout( function(){
				var now = new Date().getTime()
				var elap = (now - last)/ 1000.0
				last = now
		
				ps.clearOutBound( w, h )
				ps.step( elap )
				ps.draw( drawDiv )
				setTimeout( arguments.callee, 1000.0/30 )
			}, 0)
	
			var snowConfig = [{"id":0,"name":"發射器","lifetime":0,"vel":[0,0,0],"pos":[860,0,0],"mass":1,"color":[1,1,1,0],"size":[40,40],"tex":"glow_128_128","blending":"add","formulaList":[],"emit":{"prototype":[{"id":"1","name":"粒子","lifetime":6,"vel":[51,136,0],"pos":[0,0,0],"mass":1,"color":[1,1,1,1],"size":[14,15],"tex":"glow_png_128_128","blending":"normal","formulaList":[["lifetime","randStartAdd",2,0,0,0,0],["vy","randAdd",12,0,0,0,0],["vx","randAdd",18,0,0,0,0],["y","randStartAdd",252,0,0,0,0],["x","randStartAdd",1200,0,0,0,0],["rot","randStartAdd",6.283185307179586,0,0,0,0],["scale-y","randStartAdd",15,0,0,0,0],["scale-x","randStartAdd",15,0,0,0,0],["a","custom",0,0.5,1,0.5,0]]}],"count":1,"duration":0.300,"angle":0,"range":0,"force":0}}]
			var particleConfig = [{"id":0,"name":"發射器","lifetime":0,"vel":[0,0,0],"pos":[252,228,0],"mass":1,"color":[1,1,1,0],"size":[40,40],"tex":"glow_128_128","blending":"normal","formulaList":[],"emit":{"prototype":[{"id":"1","name":"粒子","lifetime":0.55,"vel":[0,0,4.328416544945937],"pos":[0,0,0],"mass":1,"color":[1,1,1,1],"size":[40,40],"tex":"cornerGlow_256_256","blending":"normal","formulaList":[["rot","randStartAdd",6.283185307179586,0,0,0,0],["scale-y","constMul",0.95,0,0,0,0],["scale-x","constMul",0.95,0,0,0,0],["a","constMul",0.95,0,0,0,0]]}],"count":1,"duration":0.1,"angle":0,"range":0,"force":0}}]
			
			var explodeConfig = [{"id":0,"name":"發射器","lifetime":0.01,"vel":[0,0,0],"pos":[408,457,0],"mass":1,"color":[1,1,1,0],"size":[40,40],"tex":"glow_png_128_128","blending":"normal","formulaList":[],"emit":{"prototype":[{"id":"1","name":"粒子","lifetime":5,"vel":[0,0,0],"pos":[0,0,0],"mass":1,"color":[1,1,1,1],"size":[12,12],"tex":"glow_png_128_128","blending":"normal","formulaList":[["lifetime","randStartAdd",2,0,0,0,0],["vy","randAdd",100,0,0,0,0],["vx","randAdd",100,0,0,0,0],["vy","randStartAdd",3000,0,0,0,0],["vx","randStartAdd",3000,0,0,0,0],["scale-x","constMul",0.995,0,0,0,0],["scale-y","constMul",0.995,0,0,0,0],["vx","constMul",0.95,0,0,0,0],["vy","constMul",0.95,0,0,0,0],["a","constMul",0.987,0,0,0,0]]}],"count":1,"duration":0.005,"angle":0,"range":0,"force":0}}]
	
			ps.clear()
			var parts = addParticle(pool, particleConfig);
			var snowParts = addParticle( pool, snowConfig );
	
			function addParticle( pool, config ){
				var parts = particle.parseInput( pool, config );
				ps.emit( parts )
				return parts;
			}
			
			$( 'body' ).mousemove( function( e ){
				moveRootParticles( parts, e.pageX, e.pageY );
			});
			/*
			$( 'body' ).click( function( e ){
				var particles = addParticle( pool, deepCopy( explodeConfig ) );
				moveRootParticles( particles, e.pageX, e.pageY );
			});
			*/
			function moveRootParticles( particles, x, y ){
				if( particles == undefined ) return;
				_.each( particles, function( p ){
					p.pos[0]= x;
					p.pos[1]= y;
				});
			}
	
			function deepCopy( ori ){
				return JSON.parse( JSON.stringify( ori ) );
			}
		}
		</script>
	</body>
</html>