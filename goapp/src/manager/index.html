<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>上善若水(建構中)</title>
	<meta name="description" content="" />
	
	<link rel="stylesheet" type="text/css" href="../common/js/lib/jquery-easyui-1.4.3/themes/black/easyui.css">
	<link rel="stylesheet" type="text/css" href="../common/js/lib/jquery-easyui-1.4.3/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="../common/css/normalize.css">
		
	<script type="text/javascript" src="../common/js/lib/rectSelect/rectSelect.js"></script>
	<link rel="stylesheet" type="text/css" href="../common/js/lib/rectSelect/rectSelect.css">
		
	<script type="text/javascript" src="../common/js/lib/leo.utils.js"></script>
	<script type="text/javascript" src="../common/js/lib/jquery-easyui-1.4.3/jquery.min.js"></script>
	<script type="text/javascript" src="../common/js/lib/jquery-easyui-1.4.3/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../common/js/lib/jquery/jquery.tmpl.min.js"></script>
	<script type="text/javascript" src="../common/js/lib/myapp.facebook.js"></script>
		
</head>
<style>

#btn_about,
#btn_team,
#btn_login,
#btn_stock,
#btn_particle,
#btn_card
{
	position:relative;
	width:97%;
	//height:40px;
}

#btn_stockLink,
#btn_particleLink,
#btn_cardLink{
	width:100%; 
	//height:40px;
}

.img_intro{
	width:400px;
}

.group{
	position:relative;
	width:100%;
}

.hori{
	position:relative;
	display:inline-block;
}

a{
	color:yellow;
	font-size:20px;
}
</style>
<script id="tmpl_deck" type="jquery-x-tmpl">
	<div id=${name} class="group">
		<a id="btn_remove" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-remove'" ></a>
		<div class="hori"><a id="btn_fighter" href="#" class="easyui-linkbutton" data-options="toggle:true,selected:true" >格</a></div>
		<div class="hori"><a id="btn_gundamWar" href="#" class="easyui-linkbutton" data-options="toggle:true,selected:false" >鋼</a></div>
		<div class="hori"><a id="btn_sangoWar" href="#" class="easyui-linkbutton" data-options="toggle:true,selected:false" >三</a></div>
		<div class="hori"><input id="txt_name" class="easyui-textbox" style="width:100px" value=${name}></div>
		<div class="hori"><input id="txt_cards" class="easyui-textbox" style="width:500px"></div>
	</div>
</script>
<body>
	<div class="easyui-layout" style="width:100%;height:100%;">
		<!--
		<div data-options="region:'north',split:false" style="height:35px;">
			<div style="position:absolute; right:5px; top:5px;">
				<div class="hori">
					<a href="#" id="btn_login" class="easyui-linkbutton" data-options="iconCls:'icon-fb-login',disabled:true" onclick="onBtnClick(this)" >登入</a>
				</div>
				<div class="hori">
					<a id="btn_about" href="#" class="easyui-linkbutton" onclick="$('#dia_about').panel( 'open' )" data-options="iconCls:'icon-help'"></a>
				</div>
			</div>
			
		</div>
		-->
		<div data-options="region:'west',title:'選單',split:false,collapsible:false" style="width:200px; min-width:200px;">
			<div class="group">
				<div class="group">
					<div class="hori" style="width:15%">
						<a id="btn_stockLink" href="#" class="easyui-linkbutton"  onclick="onBtnClick(this)" data-options="iconCls:'icon-back'" ></a>
					</div>
					<div class="hori" style="width:83%">
						<a id="btn_stock" href="#" class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="toggle:true,group:'g1',selected:false" >余氏k線圖</a>
					</div>
				</div>
				<div class="group">
					<div class="hori" style="width:15%">
						<a id="btn_particleLink"  href="#"  class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="iconCls:'icon-back'" ></a>
					</div>
					<div class="hori" style="width:83%">
						<a id="btn_particle" href="#" class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="toggle:true,group:'g1',selected:false" >幽夢幻境</a>
					</div>
				</div>
				<div class="group">
					<div class="hori" style="width:15%">
						<a id="btn_cardLink" href="#" class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="iconCls:'icon-back'" ></a>
					</div>
					<div class="hori" style="width:83%">
						<a id="btn_card" href="#" class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="toggle:true,group:'g1',selected:true" >卡牌風雲</a>
					</div>
					<a id="btn_team" href="#" class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="toggle:true,group:'g1'">開發人員</a>
				</div>
				<div class="group" style="margin-top:30px;">
					<a href="#" id="btn_login" class="easyui-linkbutton" data-options="iconCls:'icon-fb-login',disabled:true" onclick="onBtnClick(this)" >登入</a>
					<a id="btn_about" href="#" class="easyui-linkbutton" onclick="$('#dia_about').panel( 'open' )" data-options="iconCls:'icon-help'"></a>
				</div>
			</div>
		</div>
		<div data-options="region:'center',title:'內容'" style="">
			<div id="mc_stock" style="position:relative; width:100%; height:100%; ">
				<div class="group" style="text-align:center; margin-top:10px;">
					非常輕量級的網頁股票技術k線的觀察解決方案，可以追縱、筆記、學習指標用法等等，也可以一天一天的練習股票買賣點
					<br/>
					不用安裝、有網路即可觀看
					<br>
					<br>
					開發環境：google app engine<br>
					開發語言：golang/ haxe/ clojurescript/ javascript/ jquery easy ui<br>
				</div>
			</div>
			<div id="mc_particle" style="position:relative; width:100%; height:100%; ">
				<div class="group" style="text-align:center; margin-top:10px;">
					開發中的粒子系統，<span style="color:yellow;">目前尚存有效能問題及操作友好度問題</span>，待下次改版會解決
					<br>
					<br>
					開發環境：google app engine<br>
					開發語言：golang/ haxe/ clojurescript/ javascript/ jqxWidget<br>
				</div>
			</div>
			<div id="mc_card" style="position:relative; width:100%; height:100%; ">
				<div class="group" style="text-align:center; margin-top:10px;">
					卡牌風雲是一款基於網際網路的卡牌遊玩平台，它不限於玩哪一種類型的牌類遊戲，可以說，只要能有圖片的話，牌類遊戲都可以玩。
					<br/>
					目前收錄有：<span style="color:yellow">格鬥風雲錄、鋼彈大戰、三國志大戰</span>
					<br/>
					<br/>
					以下為組牌區，組完牌即可點擊左邊的卡牌風雲箭頭前往卡牌風雲遊戲頁面遊玩。<span style="color:yellow">這個功能要登入facebook才可以使用</span>
					<br>
					<br>
					開發環境：google app engine<br>
					開發語言：golang/ haxe/ javascript/ jquery easy ui<br>
				</div>
				<div class="group" style="text-align:center; margin-top:10px;">
					<div class="hori">
						<a id="btn_addDeck" href="#" class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="iconCls:'icon-add',disabled:true" >新增套牌</a>
					</div>
					<div class="hori">
						<a id="btn_saveDeck" href="#" class="easyui-linkbutton" onclick="onBtnClick(this)" data-options="iconCls:'icon-save',disabled:true" >存檔</a>
					</div>
				</div>
				<div id="mc_deckContainer" class="group" style="text-align:center; margin-top:10px;">
					
				</div>
			</div>
			<div id="mc_team" style="position:relative; width:100%; height:100%; display:none;">
				<div class="group" style="text-align:center; margin-top:10px;">
					<span style="font-size:20px;">余漢君 HanYu</span>
					<br/>
					<br/>
					後端工程師
					<br/>
					主要負責上善若水app的技術研發、後台資料庫、server端管理、model端編寫<br>
					專長：golang/ clojurescript/ javascript
					<br/>
					聯絡
					<a href="https://www.facebook.com/han.yu.100?fref=ufi">https://www.facebook.com/han.yu.100?fref=ufi</a>
				</div>
				<div class="group" style="text-align:center; margin-top:40px;">
					<span style="font-size:20px;">余漢平 VicYu</span>
					<br/>
					<br/>
					前端工程師
					<br/>
					主要負責上善若水app的html、ui介面、前台編寫<br>
					專長：haxe/ as3/ javascript/ html/ css
					<br/>
					<a href="https://www.facebook.com/vic.yu.14">https://www.facebook.com/vic.yu.14</a>
				</div>
			</div>
		</div>
		<div id="dia_about" class="easyui-dialog" title="卡牌風雲" data-options="iconCls:'icon-help',closed:true" style="padding:10px">
			<div class="group" style="position:relative; width:100%; text-align:center;">
				<div class="hori" >
					上善若水APP
					<br/>
					<img src="../common/images/logo.jpg" width="100" height="100">
					<br/>
					上善若水粉絲頁
					<br/>
					<a style="color:yellow; font-size:12px;" href="https://www.facebook.com/pages/上善若水/1653920964852269" target="_blank">https://www.facebook.com/pages/上善若水/1653920964852269</a>
				</div>
			</div>
		</div>
	</div>
	<script src="../common/js/lib/underscore/underscore-min.js"></script>	
	<script src="../common/js/store.js"></script>	
	<script src="../common/js/cardSuit.js"></script>	
	<script>
	/*
	online:'425311264344425',
	local:'679171275511375',
	*/
	
	var fbid, token;
	var loadModel;
	
	showLoading( '準備中...' );
	myapp.facebook.init( '425311264344425', function(){
		$('#btn_login' ).linkbutton( 'enable' );
		closeLoading();
	});
	
	openCard();
	
	function showDeckList( retModel ){
		console.log( retModel );
		$("#mc_deckContainer").empty();
		_.each( retModel.cardSuit, function( deck ){
			var copyDeck = JSON.parse( JSON.stringify( deck ) );
			addDeck( copyDeck );
		});
		console.log( 'end' );
	}
	
	function handleModel( func ){
		return function( err, ret ){
			if( err != null ){
				alert( err );
			}else{
				func( ret );
			}
		}
	}
	
	function onBtnClick( target ){
		switch( target.id ){
			case 'btn_login':
				showLoading( '登入並讀取資料中...' );
				loginFacebook( function( ret ){
					$('#btn_login' ).linkbutton( 'disable' );
					showMessage( '登入成功' );
					
					fbid = ret.authResponse.userID;
					token = ret.authResponse.accessToken;
					
					cardSuit.load( fbid, token, handleModel( function( ret ){
						loadModel = ret;
						showDeckList( loadModel );
						
						$('#btn_addDeck').linkbutton( 'enable' );
						closeLoading();
					}));
				});
				break;
			case 'btn_addDeck':
				cardSuit.editCardSuit( loadModel, {
					name: leo.utils.generateUUID(),
					game: "fighter",
					cards:[]
				})
				showDeckList( loadModel );
				break;
			case 'btn_stockLink':
				window.open( 'http://particle-979.appspot.com/stock/index.html#' );
				break;
			case 'btn_particleLink':
				window.open( 'http://particle-979.appspot.com/particle/index.html#' );
				break;
			case 'btn_cardLink':
				window.open( 'http://particle-979.appspot.com/card/index.html#' );
				break;
			case 'btn_stock':
				openStock();
				break;
			case 'btn_particle':
				openParticle();
				break;
			case 'btn_card':
				openCard();
				break;
			case 'btn_team':
				openTeam();
				break;
		}
	}
	
	$('#btn_saveDeck' ).linkbutton( {
		onClick:function(){
			showLoading( '存檔中...' );
			cardSuit.save( fbid, token, loadModel, handleModel( function( ret ){
				showMessage( '存檔成功' );
				$('#btn_saveDeck' ).linkbutton( 'disable' );
				
				closeLoading();
			}));
		}
	});
	
	function editAndShow(){
		showDeckList( loadModel );
		$('#btn_saveDeck' ).linkbutton( 'enable' );
	}
	
	function addDeck( _model ){
		var dom = $("#tmpl_deck" ).tmpl( _model );
		$('#mc_deckContainer').append( dom );
		dom.find( '.easyui-linkbutton' ).linkbutton({
			group:_model.name,
			onClick:(function( __model ){
				return function(){
					switch( this.id ){
						case 'btn_fighter':__model.game = 'fighter';break;
						case 'btn_gundamWar':__model.game = 'gundamWar';break;
						case 'btn_sangoWar':__model.game = 'sangoWar';break;
					}
					cardSuit.editCardSuit( loadModel, __model );
					editAndShow();
				}
			})( _model )
		});
		dom.find( '.easyui-textbox' ).textbox();
		dom.find( '.easyui-textbox' ).textbox({
			onChange:(function( __model ){
				return function( nv, ov ){
					switch( $( this ).attr( 'id' )){
						case 'txt_name':
							__model.name = nv;
							cardSuit.editCardSuit( loadModel, __model );
							editAndShow();
							break;
						case 'txt_cards':
							try{
								__model.cards = JSON.parse( '[' + nv + ']' );
							}catch( e ){
								showAlert("格式輸入錯誤，請檢查");
							}
							cardSuit.editCardSuit( loadModel, __model );
							editAndShow();
							break;
					}
					
				}
			})( _model )
		});
		
		var cardstr = (function(){
			var str = JSON.stringify( _model.cards );
			str = str.substr( 1, str.length - 2 );
			return str;
		})();
		switch( _model.game ){
			case 'fighter':
				dom.find( '#btn_fighter' ).linkbutton( 'select' );
				break;
			case 'gundamWar':
				dom.find( '#btn_gundamWar' ).linkbutton( 'select' );
				break;
			case 'sangoWar':
				dom.find( '#btn_sangoWar' ).linkbutton( 'select' );
		}
		
		dom.find( '#txt_cards' ).textbox( {
			value:cardstr
		});
		
		dom.find( '#btn_remove' ).click( function(){
			cardSuit.removeCardSuit( loadModel, $(this).attr( 'group' ) );
			editAndShow();
		});
	}
	
	function loginFacebook( cb ){
		myapp.facebook.login( cb );
	}
	
	function openStock(){
		$('#mc_stock' ).show();
		$('#mc_particle' ).hide();
		$('#mc_card' ).hide();
		$('#mc_team' ).hide();
	}
	
	function openParticle(){
		$('#mc_stock' ).hide();
		$('#mc_particle' ).show();
		$('#mc_card' ).hide();
		$('#mc_team' ).hide();
	}
	
	function openCard(){
		$('#mc_stock' ).hide();
		$('#mc_particle' ).hide();
		$('#mc_card' ).show();
		$('#mc_team' ).hide();
	}
	
	function openTeam(){
		$('#mc_stock' ).hide();
		$('#mc_particle' ).hide();
		$('#mc_card' ).hide();
		$('#mc_team' ).show();
	}
	
	function showMessage( msg ){
		$.messager.show({
			title:'提示',
			msg: msg,
			timeout:2000,
			showType:'slide'
		});
	}
	
	function showAlert( msg ){
		$.messager.alert('錯誤', msg );
	}
	
	function showLoading( msg ){
		$.messager.progress({
			title:'提示',
			msg: msg 
		});
	}
	
	function closeLoading(){
		$.messager.progress( 'close' ); 
	}
	
	</script>
	<script src="js/manager.js"></script>
</body>
</html>