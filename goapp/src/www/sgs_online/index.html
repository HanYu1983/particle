<!DOCTYPE html>
<html>
	<style>
	body{
		margin:0;
		overflow:hidden;
	}
	.relative{
		position:relative;
	}
	.absolute{
		position:absolute;
	}
	.top_left{
		left:0;
		top:0;
	}
	.full{
		width:100%;
		height:100%;
	}
	.group{
		position:relative;
		width:100%;
	}
	.hori{
		display:inline-block;
	}
	.horiCenter{
		text-align:center;
	}
	.hide{
		display:none;
	}
	.menuButton{
		width:48%;
	}
	.loginMenuButton{
		width:70px;
	}
	</style>
	<body class="easyui-layout">
		
		<div data-options="region:'west',title:'West',split:false" style="width:300px;">
			<div id="acc_leftPanel" class="easyui-accordion" data-options="multiple:true" style="width:100%;">
				<div title="卡片詳情" data-options="iconCls:'icon-save',selected:true" style="padding:10px;">
					<img class="group top_left relative" src="asset/01030.jpg" />
				</div>
				<div title="指令" data-options="iconCls:'icon-reload',selected:true" style="padding:10px;">
					<div class="group hori">
						<a id="btn" href="#" class="easyui-linkbutton menuButton" >使用</a>
						<a id="btn" href="#" class="easyui-linkbutton menuButton" >使用</a>
						<a id="btn" href="#" class="easyui-linkbutton menuButton" >使用</a>
						<a id="btn" href="#" class="easyui-linkbutton menuButton" >使用</a>
					</div>
				</div>
			</div>
		</div>
		<div data-options="region:'center',title:'center title'">
			<div id="webgl" style='position:relative; width:100%; height:100%;'></div>
		</div>
		
		<div id="win_login" class="easyui-window" title="對戰列表" data-options="collapsible:false,minimizable:false,maximizable:false,closable:false,modal:true,draggable:false,resizable:false" style="width:290px; padding:10px">
			<div class="group hori">
				<a id="btn_login" href="#" class="easyui-linkbutton loginMenuButton" >登入</a>
				<input id="txt_id" class="easyui-textbox"  style="width:173px;">
			</div>
			<div class="group hori">
				<a id="btn_create" href="#" class="easyui-linkbutton loginMenuButton" >創建</a>
				<input id="chk_pri" class="easyui-switchbutton" data-options="onText:'私有',offText:'公開'">
				<input id="txt_roomName" class="easyui-textbox"  style="width:110px;">
			</div>
			<div class="group hori">
				<a id="btn_enter" href="#" class="easyui-linkbutton loginMenuButton" >進入</a>
				<input id="txt_enterName" class="easyui-textbox"  style="width:173px">
			</div>
			<div id="div_container" class="group">
				<!-- for script -->
			</div>
		</div>
		
		<div id="dia_command" class="easyui-dialog" title="邀戰通知" data-options="iconCls:'icon-help',closed:true" style="width:300px; padding:10px">
			<div class="group" style="text-align:center;">
				<div id="txt_from" style="color:yellow;"></div>
				<div >要求連線對戰！要求對象：</div>
				<div id="txt_output" style="color:yellow;"></div>
				<br/>
				<a id="btn_receive" href="#" class="easyui-linkbutton" style="width:60px; height:40px; " data-options="iconCls:'icon-ok', disabled:false">連線</a>
			</div>
		</div>
	
		<link rel="stylesheet" type="text/css" href="../common/js/lib/jquery-easyui-1.4.3/themes/black/easyui.css">
		<link rel="stylesheet" type="text/css" href="../common/js/lib/jquery-easyui-1.4.3/themes/icon.css">
		<link rel="stylesheet" type="text/css" href="../common/js/lib/jquery-easyui-1.4.3/themes/color.css">
		<link rel="stylesheet" type="text/css" href="../common/css/normalize.css">
			
		<script src='https://cdnjs.cloudflare.com/ajax/libs/ramda/0.21.0/ramda.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.min.js'></script>
		<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.1.0/rx.all.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js'></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/async/2.1.4/async.min.js"></script>
		<script src='http://tweener.ivank.net/tw.js'></script>
		<script src="../common/js/lib/threejs/ColladaLoader.js"></script>
		<script src="../common/js/lib/threejs/CopyShader.js"></script>
		<script src="../common/js/lib/threejs/EffectComposer.js"></script>
		<script src="../common/js/lib/threejs/RenderPass.js"></script>
		<script src="../common/js/lib/threejs/ShaderPass.js"></script>
		<script src="../common/js/lib/threejs/OutlinePass.js"></script>
		
		
		<script type="text/javascript" src="../common/js/lib/jquery-easyui-1.4.3/jquery.min.js"></script>
		<script type="text/javascript" src="../common/js/lib/jquery-easyui-1.4.3/jquery.easyui.min.js"></script>
		<script type="text/javascript" src="../common/js/lib/jquery/jquery.cookie.js"></script>
		<script type="text/javascript" src="../common/js/lib/jquery/jquery.tmpl.min.js"></script>
		<script src="js/vic.tools.js"></script>
		<script src="js/Main.js"></script>

		<script type="text/javascript" src="/_ah/channel/jsapi"></script>

		<script name="model" src="js/model.js"></script>

		<script name="test">
			var user = 'han'
			model.newRoom(user, function(err, room){
			    if( err ){
			        console.log(err)
				} else {
			        model.joinRoom(room.ID, 'vic', function(err, res){
			            if( err ){
			                console.log(err)
						} else {
                            if( err ){
                                console.log(err)
                            } else {
                                model.updateRoom(room.ID, {
                                    userA: user,
									userB: 'vic'
								}, function(err, res){
                                    if( err ){
                                        console.log(err)
									} else {
                                        model.startGame(room.ID, function(err, res){
                                            if( err ){
                                                console.log(err)
                                            } else {
                                                model.collectCommand(room.ID, user, function(err, res){
                                                    if( err ){
                                                        console.log(err)
                                                    } else {
                                                        var passCmd = res[0]
														model.pushCommand(room.ID, passCmd, function(err, res){
														    if( err ){
														        console.log(err)
															} else {
                                                                model.collectCommand(room.ID, user, function(err, res){
                                                                    console.log(arguments)
                                                                })
															}
														})
                                                    }
                                                })
                                            }
                                        })
									}
								})
                            }
						}
					})
				}
			})
		</script>

		<script>

		
		$(document).ready( initPage );
		
		function initPage(){
			var btn_login = $("#btn_login" );
			var btn_create = $("#btn_create" );
			var btn_enter = $("#btn_enter" );
			var txt_id = $("#txt_id" );
			var txt_roomName = $("#txt_roomName" );
			var txt_enterName = $("#txt_enterName" );
			var chk_pri = $("#chk_pri" );
			var div_container = $("#div_container" );
			var needPrivate = false;
			var acc_leftPanel = $("#acc_leftPanel" );
			var win_login = $("#win_login" );
			var playerName = '';
			
			function login( user ){
				model.joinLobby(user, {
					onopen: function(){
						playerName = user;
						model.roomList( function( error, val){
							if( error == null ){
								listRoom( val );
							}
						});
					},
					onmessage: function(path, option){
						var msg = path.data
						console.log('onmessage'+msg)
						
					},
					onerror: function(){
						console.log('onerror')
					},
					onclose: function(){
						console.log('onclose')
					}
				})
			}
			
			chk_pri.switchbutton({
				onChange:function( chk ){
					pri = chk;
				}
			});
			
			btn_login.linkbutton({
				onClick:function(){
					var id = txt_id.textbox( 'getValue' );
					if( id != '' ){
						login( id );
					}
				}
			});
			btn_create.linkbutton({
				onClick:function(){
					var roomName = txt_roomName.textbox( 'getValue' );
					if( roomName != '' ){
						model.newRoom( playerName, 25, function( error, val ){
							if( error == null ) {
								model.roomList( function( error, val){
									if( error == null ){
										listRoom( val );
									}
								});
							}
						});
					}
				}
			});
			btn_enter.linkbutton({
				onClick:function(){
					var enterName = txt_enterName.textbox( 'getValue' );
					if( enterName != '' ){
						model.joinRoom( enterName, playerName, function(error, val){
							if( error == null ){
								var playerId = val.Players[0];
								var enemyId = val.Players[1];
							}
						});
					}else{
						model.autoMatch( playerName, function(error, val){
							if( error == null ){
								var playerId = val.Players[0];
								var enemyId = val.Players[1];
							}
						});
					}
				}
			});
			
			
			function listRoom( ary_room ){
				acc_leftPanel.accordion( 'select', 1 );
				div_container.empty();
				for( var i = 0; i < ary_room.length; ++i ){
					var roomButton = $('<a href="#" class="easyui-linkbutton roomButton" style="width:248px" >' + ary_room[i].ID + '</a>' );
					roomButton.attr( 'roomId', ary_room[i].ID );
					roomButton.linkbutton( {
						onClick:function(){
							var roomId = $(this).attr('roomId');
							model.joinRoom( roomId, playerName, function(error, val){
								if( error == null ){
									var playerId = val.Players[0];
									var enemyId = val.Players[1];
									win_login.window( 'close' );
								}
							});
						}
					});
					div_container.append( roomButton );
				}
			}
		}
		</script>
	</body>
</html>